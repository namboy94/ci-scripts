# Python Builder

## Project Structure

To use the python builder, you will need to have a python project with the
following structure at the very least:

    - project-name
    --- project
    ----- metadata.py
    ----- main.py
    --- CHANGELOG
    --- builder.py
    
The CHANGELOG file must be updated for every version and have the following format:

    V 0.3.0:
      - Changes
      - More Changes
      - Even More Changes
     V 0.2.0
       - Other Changes
       
The main.py file must be able to start the program.

The metadata.py file is used to determine the different characteristics
of the project. Please check this project's metadata file for 
information on how to format the file.

Basically, it consists of four classes:
 
  - GitRepository:  Information on the Repositories associated with this project
  - General:        General Information about the project
  - PyPiVariables:  Used to determine the metadata for the python package index
  - SentryLogger:   (Optional) Can be used to log bugs in the project using Sentry

## Usage

The python builder module is:

    gitlab_build_scripts.project_builders.python
    
It has a method called 'build' with the signature

    build(metadata_module: 'module', build_modules: List[BuildModule]=[])
    
The ```metadata_module``` is the import of the ```metadata.py``` file.
The list of BuildModules is a list of different classes from the 
```gitlab_build_scripts.buildmodules.python package```

Once the builder.py file is set up using these modules (See te example further down),
you can call the modules like this:

    python builder.py <mode> <optional arguments...>
    
The available modes are defined by the buildmodules passed to the build()
method. 


### Default Modes


**Github/Gitlab release**

The commands

    python builder.py github-release
    python builder.py gitlab-release
 
create a new release/tag on Gitlab/Github respectively and upload any
files generated by other buildmodules. NOTE: The Gitlab Release functionality does NOT
support uploading files as of right now due to a Gitlab API limitation.

**HTML Indexer**

The commands

    python builder.py gitstats-html      <root-directory>
    python builder.py documentation-html <root-directory>
    python builder.py coverage-html      <root-directory>
    
create an index.html file inside a local VHost containing git statistics
or documentation. It is assumed that the gitlab runner has write permissions to the
specified directory. The directories should look like this:

  - gitstats:
  
    |-- root
    |  |-- gitstats
    |  |  |-- project
    |  |  |  |-- index.html
    |  |-- git_stats
    |  |  |-- project
    |  |  |  |-- index.html
    
  - documentation:
  
    |-- root
    |  |-- html_docs
    |  |  |-- project
    |  |  |  |-- index.html
    |  |-- pdf_docs
    |  |  |-- project.pdf
    
  - test coverage:
  
    |-- root
    |  |-- project
    |  |  |-- index.html
        
## Available Optional Build Modules:

### PyInstallerWindows / PyInstallerLinux

Both of these modules make use of PyInstaller to generate a binary file
based on the main.py file. The Windows version needs to run on a
Windows PC/Gitlab Runner, and the Linux version on a Linux PC/Gitlab Runner.

It generates a single binary file, then saves it in build/gitlab_build_scripts/
where it can then be picked up by the python builder to upload it as a release
asset to Github or Gitlab

The commands to run the PyInstallers are:

    python builder.py build pyinstaller_linux
    python builder.py build pyinstaller_windows
    
## Example builder.py

    import project.metadata as metadata
    from gitlab_build_scripts.project_builders.python import build
    from gitlab_build_scripts.buildmodules.python.PyInstallerLinux import PyInstallerLinux
    from gitlab_build_scripts.buildmodules.python.PyInstallerWindows import PyInstallerWindows

    if __name__ == "__main__":
        build(metadata, [PyInstallerLinux, PyInstallerWindows])

